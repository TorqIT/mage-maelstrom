import{Combatant as t}from"../MageMaelstrom";import{ReadonlyCoordinate as e}from"../MageMaelstrom/Arena";import{mmZap as s}from"../MageMaelstrom/Common/Icon";class Spellslinger extends t{rotation=[];target=new e;define(){return{name:"Spellslinger",icon:s.file,strength:10,agility:10,intelligence:20,abilities:["zap","fireball","ice","ranged"],handicap:!0}}init({arena:t,you:s}){this.rotation=[new e({x:3,y:3}),new e({x:t.width-3,y:3}),new e({x:t.width-3,y:t.height-3}),new e({x:3,y:t.height-3})]; this.target=s.coords.getClosest(this.rotation); this.shout("Ready for battle!")}act(t){var e;return null!==(e=this.getFirstValidAction([()=>this.panicRun(t),()=>this.slappyHands(t),()=>this.slingSpell(t),()=>this.getIntoSweetSpot(t),()=>this.search(t)]))&&void 0!==e?e:t.actions.dance()}getFirstValidAction(t){for(const e of t){const t=e();if(t)return t}}search({actions:t}){for(let e=0;e<10;e++){const e=t.moveTo(this.target);if(e)return this.shout("We search..."),e;this.target=this.rotation[Math.floor(Math.random()*this.rotation.length)]}}getIntoSweetSpot({actions:t,helpers:e,visibleEnemies:s,you:i}){if(0===s.length)return;const o=e.getClosest(s),n=i.coords.getDistance(o.coords);return n<=1.5?(this.shout("TOO CLOSE! Repositioning!"),t.runFrom(o)):n>3?(this.shout("Too far! Repositioning!"),t.moveTo(o)):void 0}slingSpell({spells:[t,e,s],visibleEnemies:i,helpers:o,actions:n}){for(const r of i){const i=n.cast(s,r.id),a=n.cast(e,r.id),l=n.cast(t,r.id);if(!r.statusesEffects.includes("ice")&&o.canPerform(i))return this.shout("I cast... ice!"),i;if(o.canPerform(a))return this.shout("I cast... fire!"),a;if(o.canPerform(l))return this.shout("I cast... lightning!"),l}}slappyHands({visibleEnemies:t,you:e,actions:s,helpers:i}){if(e.mana.value<20&&t.length>0)return this.shout("I cast... uh... fist?"),s.attackMove(i.getClosest(t))}panicRun({helpers:t,visibleEnemies:e,actions:s,you:i}){const o=t.getClosest(e);if(o&&i.coords.isNextTo(o.coords)&&Math.random()>.5)return this.shout("OH GOD WAAAY TOO CLOSE"),s.runFrom(o)}onTakeDamage(t){}onStatusEffectApplied(t){}}export const spellslingers={name:"Spellslingers",color:"#38F",author:"Nick",CombatantSubclasses:[Spellslinger,Spellslinger]};